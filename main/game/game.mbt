///|
let boss_borned : Ref[Bool] = Ref::new(false)

///|
let taotle_killed : Ref[Bool] = Ref::new(false)

///|
let xtale_killed : Ref[Bool] = Ref::new(false)

///|
/// 当前游戏实例的全局引用（可空类型）
///
/// 该变量存储当前正在进行的游戏实例。当游戏未开始时，值为 None；当游戏开始时，
/// 值为 Some(Game)。游戏结束时会被重置为 None。使用 Ref 类型允许在函数间共享
/// 和修改游戏状态。
let current_game : Ref[Game?] = Ref::new(None)

///|
/// 游戏实例结构体
///
/// 该结构体封装了游戏的核心数据，包括地图信息。游戏实例是游戏进行时的核心状态
/// 容器，所有游戏逻辑都基于这个实例进行操作。
///
/// 字段说明：
/// - map: 当前游戏的地图实例，包含所有房间、地块、占用者等信息
priv struct Game {
  map : Map_
}

///|
/// 创建新的游戏实例
///
/// 该函数用于初始化一个新的游戏实例。函数会创建一个新的地图，并设置初始房间。
/// 初始房间的位置由传入的坐标集合确定，这些坐标代表游戏开始时的起始房间位置。
///
/// 参数说明：
/// - 无参数
///
/// 返回值：
/// - 返回新创建的 Game 实例
///
/// 初始化逻辑：
/// - 创建新的地图实例，初始房间位置为 (0, 3), (0, 4), (0, 5)
/// - 这些坐标代表游戏开始时的起始房间位置
///
/// 使用场景：
/// - 游戏开始时创建新游戏实例
/// - 需要重置游戏状态时
///
/// 注意事项：
/// - 初始房间位置是硬编码的，未来可能需要配置化
/// - 地图创建时会自动生成初始房间
fn Game::new() -> Game {
  { map: Map_::new(Set::from_array([(0, 3), (0, 4), (0, 5)])) }
}

///|
/// 强制获取当前游戏的地图实例（不安全操作）
///
/// 该函数用于获取当前游戏的地图实例。函数使用 unwrap() 强制解包，如果当前没有
/// 游戏实例（current_game.val 为 None），会导致程序崩溃。因此函数名使用 "force"
/// 前缀表示这是一个不安全的操作。
///
/// 参数说明：
/// - 无参数
///
/// 返回值：
/// - 返回当前游戏的地图实例 Map_
/// - 如果当前没有游戏实例，会触发 panic
///
/// 使用场景：
/// - 需要访问当前地图时（确保游戏已开始）
/// - 游戏逻辑中需要操作地图时
///
/// 注意事项：
/// - 函数使用 unwrap()，如果游戏未开始会导致程序崩溃
/// - 确保在调用此函数前游戏已经初始化
/// - 建议在调用前检查 current_game.val 是否为 Some
fn force_get_current_map() -> Map_ {
  current_game.val.unwrap().map
}
